<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sort Collection Entries</title>
</head>
<body>
    <h1 id="collection-title">Collection Entries</h1>

    <label for="sort-select">Sort by:</label>
    <select id="sort-select">
        <option value="alphabetical">Alphabetical</option>
        <option value="genre">Genre</option>
    </select>

    <ul id="entries-list">
        <!-- Entries will be injected here -->
    </ul>

    <script>
        const API_URL = 'http://localhost:8080';

        function getCollectionIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('collectionid');
        }

        function fetchAndDisplayEntries(collectionId, sortBy = 'alphabetical') {
            fetch(`${API_URL}/collections/${collectionId}/sort?sort_by=${sortBy}`)
                .then(res => res.json())
                .then(data => {
                    displayEntries(data);
                })
                .catch(error => {
                    console.error('Error fetching sorted entries:', error);
                    document.getElementById('entries-list').innerHTML = '<li>Error loading entries.</li>';
                });
        }

        function displayEntries(entries) {
            const entriesList = document.getElementById('entries-list');
            entriesList.innerHTML = ''; // Clear previous entries

            entries.forEach(entry => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${entry.title}</strong>`;

                if (entry.type === 'media' && entry.genres) {
                    li.innerHTML += ` - Genres: ${entry.genres.join(', ')}`;
                } else if (entry.type === 'videogames' && entry.platform) {
                    li.innerHTML += ` - Platform: ${entry.platform}`;
                } else if (entry.description) {
                    li.innerHTML += ` - ${entry.description}`;
                }

                entriesList.appendChild(li);
            });
        }

        function fetchAndSetCollectionTitle(collectionId) {
            fetch(`${API_URL}/collections`)
                .then(res => res.json())
                .then(collections => {
                    const collection = collections.find(c => c.id === parseInt(collectionId));
                    if (collection) {
                        document.getElementById('collection-title').textContent = collection.collection_title;
                    }
                })
                .catch(() => {
                    document.getElementById('collection-title').textContent = 'Collection Entries';
                });
        }

        document.addEventListener('DOMContentLoaded', () => {
            const collectionId = getCollectionIdFromUrl();
            if (!collectionId) {
                document.getElementById('entries-list').innerHTML = '<li>Invalid Collection ID</li>';
                return;
            }

            fetchAndSetCollectionTitle(collectionId);
            fetchAndDisplayEntries(collectionId); // Default sort

            document.getElementById('sort-select').addEventListener('change', (e) => {
                const sortBy = e.target.value;
                fetchAndDisplayEntries(collectionId, sortBy);
            });
        });
    </script>
</body>
</html>
